{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Maxim/Desktop/FreshCook-app/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Maxim/Desktop/FreshCook-app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axiosInstance from\"./api\";import TokenService from\"./tokenService\";import{refreshToken}from\"../redux/actions/auth\";var setup=function setup(store){axiosInstance.interceptors.request.use(function(config){var token=TokenService.getLocalAccessToken();if(token){// config.headers[\"Authorization\"] = 'Bearer ' + token;  // for Spring Boot back-end\nconfig.headers[\"x-access-token\"]=token;// for Node.js Express back-end\n}return config;},function(error){return Promise.reject(error);});var dispatch=store.dispatch;axiosInstance.interceptors.response.use(function(res){return res;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(err){var originalConfig,rs,accessToken;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:originalConfig=err.config;if(!(originalConfig.url!==\"/auth/signin\"&&err.response)){_context.next=17;break;}if(!(err.response.status===401&&!originalConfig._retry)){_context.next=17;break;}originalConfig._retry=true;_context.prev=4;_context.next=7;return axiosInstance.post(\"/auth/refreshtoken\",{refreshToken:TokenService.getLocalRefreshToken()});case 7:rs=_context.sent;accessToken=rs.data.accessToken;dispatch(refreshToken(accessToken));TokenService.updateLocalAccessToken(accessToken);return _context.abrupt(\"return\",axiosInstance(originalConfig));case 14:_context.prev=14;_context.t0=_context[\"catch\"](4);return _context.abrupt(\"return\",Promise.reject(_context.t0));case 17:return _context.abrupt(\"return\",Promise.reject(err));case 18:case\"end\":return _context.stop();}}},_callee,null,[[4,14]]);}));return function(_x){return _ref.apply(this,arguments);};}());};export default setup;","map":{"version":3,"names":["axiosInstance","TokenService","refreshToken","setup","store","interceptors","request","use","config","token","getLocalAccessToken","headers","error","Promise","reject","dispatch","response","res","err","originalConfig","url","status","_retry","post","getLocalRefreshToken","rs","accessToken","data","updateLocalAccessToken"],"sources":["C:/Users/Maxim/Desktop/FreshCook-app/client/src/services/setupInterceptors.js"],"sourcesContent":["import axiosInstance from \"./api\";\r\nimport TokenService from \"./tokenService\";\r\nimport { refreshToken } from \"../redux/actions/auth\";\r\nconst setup = (store) => {\r\n  axiosInstance.interceptors.request.use(\r\n    (config) => {\r\n      const token = TokenService.getLocalAccessToken();\r\n      if (token) {\r\n        // config.headers[\"Authorization\"] = 'Bearer ' + token;  // for Spring Boot back-end\r\n        config.headers[\"x-access-token\"] = token; // for Node.js Express back-end\r\n      }\r\n      return config;\r\n    },\r\n    (error) => {\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n  const { dispatch } = store;\r\n  axiosInstance.interceptors.response.use(\r\n    (res) => {\r\n      return res;\r\n    },\r\n    async (err) => {\r\n      const originalConfig = err.config;\r\n      if (originalConfig.url !== \"/auth/signin\" && err.response) {\r\n        // Access Token was expired\r\n        if (err.response.status === 401 && !originalConfig._retry) {\r\n          originalConfig._retry = true;\r\n          try {\r\n            const rs = await axiosInstance.post(\"/auth/refreshtoken\", {\r\n              refreshToken: TokenService.getLocalRefreshToken(),\r\n            });\r\n            const { accessToken } = rs.data;\r\n            dispatch(refreshToken(accessToken));\r\n            TokenService.updateLocalAccessToken(accessToken);\r\n            return axiosInstance(originalConfig);\r\n          } catch (_error) {\r\n            return Promise.reject(_error);\r\n          }\r\n        }\r\n      }\r\n      return Promise.reject(err);\r\n    }\r\n  );\r\n};\r\nexport default setup;"],"mappings":"kRAAA,MAAOA,cAAP,KAA0B,OAA1B,CACA,MAAOC,aAAP,KAAyB,gBAAzB,CACA,OAASC,YAAT,KAA6B,uBAA7B,CACA,GAAMC,MAAK,CAAG,QAARA,MAAQ,CAACC,KAAD,CAAW,CACvBJ,aAAa,CAACK,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CACE,SAACC,MAAD,CAAY,CACV,GAAMC,MAAK,CAAGR,YAAY,CAACS,mBAAb,EAAd,CACA,GAAID,KAAJ,CAAW,CACT;AACAD,MAAM,CAACG,OAAP,CAAe,gBAAf,EAAmCF,KAAnC,CAA0C;AAC3C,CACD,MAAOD,OAAP,CACD,CARH,CASE,SAACI,KAAD,CAAW,CACT,MAAOC,QAAO,CAACC,MAAR,CAAeF,KAAf,CAAP,CACD,CAXH,EAaA,GAAQG,SAAR,CAAqBX,KAArB,CAAQW,QAAR,CACAf,aAAa,CAACK,YAAd,CAA2BW,QAA3B,CAAoCT,GAApC,CACE,SAACU,GAAD,CAAS,CACP,MAAOA,IAAP,CACD,CAHH,4FAIE,iBAAOC,GAAP,sJACQC,cADR,CACyBD,GAAG,CAACV,MAD7B,MAEMW,cAAc,CAACC,GAAf,GAAuB,cAAvB,EAAyCF,GAAG,CAACF,QAFnD,gCAIQE,GAAG,CAACF,QAAJ,CAAaK,MAAb,GAAwB,GAAxB,EAA+B,CAACF,cAAc,CAACG,MAJvD,2BAKMH,cAAc,CAACG,MAAf,CAAwB,IAAxB,CALN,sCAOyBtB,cAAa,CAACuB,IAAd,CAAmB,oBAAnB,CAAyC,CACxDrB,YAAY,CAAED,YAAY,CAACuB,oBAAb,EAD0C,CAAzC,CAPzB,QAOcC,EAPd,eAUgBC,WAVhB,CAUgCD,EAAE,CAACE,IAVnC,CAUgBD,WAVhB,CAWQX,QAAQ,CAACb,YAAY,CAACwB,WAAD,CAAb,CAAR,CACAzB,YAAY,CAAC2B,sBAAb,CAAoCF,WAApC,EAZR,gCAae1B,aAAa,CAACmB,cAAD,CAb5B,4FAeeN,OAAO,CAACC,MAAR,aAff,0CAmBSD,OAAO,CAACC,MAAR,CAAeI,GAAf,CAnBT,uEAJF,gEA0BD,CAzCD,CA0CA,cAAef,MAAf"},"metadata":{},"sourceType":"module"}